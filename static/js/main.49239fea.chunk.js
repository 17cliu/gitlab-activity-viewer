(this["webpackJsonpgitlab-activity-viewer"]=this["webpackJsonpgitlab-activity-viewer"]||[]).push([[0],{21:function(e,t,a){},25:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a(0),s=a.n(r),c=a(12),o=a.n(c),l=(a(21),a(3)),i=a(7),d=a(15);var u=function(e){var t=e.id,a=e.label,r=e.name,s=e.placeholder,c=void 0===s?"":s,o=e.error,l=e.register;return Object(n.jsxs)("div",{className:"form-row",children:[Object(n.jsx)("label",{htmlFor:t,children:a}),Object(n.jsx)("input",{type:"text",className:"text-input ".concat(o&&"is-invalid"),id:t,name:r||t,placeholder:c,"aria-invalid":o?"true":"false",ref:l}),o&&Object(n.jsx)("div",{role:"alert",className:"invalid-message",children:o})]})};var b=function(e){var t,a,r,s,c,o,l,i=e.onSubmit,b=Object(d.a)(),h=b.register,m=b.watch,j=b.errors,p=b.handleSubmit,f="true"===m("isCustomHost");return"required"===(null===(t=j.accessToken)||void 0===t?void 0:t.type)?o="Please enter access token":"pattern"===(null===(a=j.accessToken)||void 0===a?void 0:a.type)&&(o="Access token must contain only letters and numbers"),"required"===(null===(r=j.username)||void 0===r?void 0:r.type)?l="Please enter username":"minLength"===(null===(s=j.username)||void 0===s?void 0:s.type)?l="Username must be at least two letters long":"pattern"===(null===(c=j.username)||void 0===c?void 0:c.type)&&(l="Username must contain only letters, numbers, dash (-), underscore (_), and periods (.)"),Object(n.jsxs)("form",{onSubmit:p((function(e){var t={host:"true"===e.isCustomHost?e.customHost:"gitlab.com",accessToken:e.isCustomHost?e.accessToken:"",username:e.username};i(t)})),className:"form",children:[Object(n.jsxs)("div",{className:"form-row",children:[Object(n.jsxs)("fieldset",{className:"fieldset",children:[Object(n.jsx)("legend",{htmlFor:"host",children:"My profile is on..."}),Object(n.jsxs)("label",{className:"radio-label",children:[Object(n.jsx)("input",{type:"radio",className:"radio-input",name:"isCustomHost",value:"false",ref:h,defaultChecked:!0}),"GitLab.com"]}),Object(n.jsxs)("label",{className:"radio-label",children:[Object(n.jsx)("input",{type:"radio",className:"radio-input",name:"isCustomHost",value:"true",ref:h}),"A self-hosted instance of GitLab..."]})]}),f&&Object(n.jsxs)("div",{className:"nested-fields",children:[Object(n.jsx)(u,{id:"customHost",label:"URL of your GitLab instance (e.g. gitlab.mycompany.com)",placeholder:"git.mycompany.com",error:j.customHost&&"Please enter domain",register:h({required:!0})}),Object(n.jsx)(u,{id:"accessToken",label:"Your access token (generate one with `read_api` scope at User Settings > Access Tokens)",placeholder:"YOUR_API_KEY",error:o,register:h({required:!0,pattern:/^[a-z0-9]+$/i})})]})]}),Object(n.jsx)(u,{id:"username",label:"Your username",error:l,register:h({required:!0,pattern:/^[a-z0-9-_.]{2,}$/i,minLength:2})}),Object(n.jsx)("input",{className:"btn",type:"submit",value:"Go!"})]})},h=a(5),m=a(2),j=a.n(m),p=a(6),f=a(4);function v(){return(v=Object(p.a)(j.a.mark((function e(t){var a,n,r,s,c,o,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.host,n=t.username,r=t.accessToken,s=new URL("https://".concat(a,"/api/v4/users?username=").concat(n)),c={},r&&(c.headers={"PRIVATE-TOKEN":r}),e.next=6,fetch(s,c);case 6:return o=e.sent,e.next=9,o.json();case 9:if(!(l=e.sent).length){e.next=14;break}return e.abrupt("return",l[0]);case 14:throw new Error("User not found");case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return g.apply(this,arguments)}function g(){return(g=Object(p.a)(j.a.mark((function e(t){var a,n,r,s,c,o,i,d,u,b,h;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.host,n=t.userId,r=t.accessToken,s=new URLSearchParams(Object(l.a)({per_page:100},t.queryOptions)),c=new URL("https://".concat(a,"/api/v4/users/").concat(n,"/events?").concat(s.toString())),e.next=5,fetch(c,{headers:{"PRIVATE-TOKEN":r||"rxzmcimEJzXxyTuVcGpt"}});case 5:return o=e.sent,e.next=8,o.json();case 8:return i=e.sent,d=o.headers,u=d.get("x-next-page"),b=Number(d.get("x-total")),h=Number(d.get("x-total-pages")),e.abrupt("return",{total:b,totalPages:h,nextPage:u,data:i});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y="LOADING",x="SUCCESS",w="ERROR";function M(e){var t=e.host,a=e.username,n=e.accessToken,s=Object(r.useState)(null),c=Object(i.a)(s,2),o=c[0],d=c[1],u=Object(r.useState)({data:[],total:0}),b=Object(i.a)(u,2),h=b[0],m=b[1],g=Object(r.useState)(0),M=Object(i.a)(g,2),k=M[0],_=M[1],N=Object(r.useState)(y),T=Object(i.a)(N,2),D=T[0],C=T[1];return Object(r.useEffect)((function(){C(y),function(e){return v.apply(this,arguments)}({host:t,username:a,accessToken:n}).then(d).catch((function(e){console.warn("Could not fetch user",e),d(null),C(w)}))}),[t,a,n]),Object(r.useEffect)((function(){o&&(C(y),O({host:t,userId:o.id,accessToken:n}).then((function(e){var a=Math.min(e.totalPages,10);if(m(e),_(e.data.length),e.nextPage){var r=Object(f.a)(Array(a+1).keys()).slice(2);console.log("Attempting to fetch more pages:",r);var s=r.map(function(){var e=Object(p.a)(j.a.mark((function e(a){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O({host:t,userId:o.id,accessToken:n,queryOptions:{page:a}});case 2:return r=e.sent,_((function(e){return e+r.data.length})),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());Promise.allSettled(s).then((function(t){var a=t.reduce((function(e,t,a){return"fulfilled"===t.status?Object(l.a)(Object(l.a)({},e),{},{nextPage:t.value.nextPage,data:e.data.concat(t.value.data)}):(console.log("Failed to fetch chunk of events!",a),e)}),Object(l.a)({},e));m(a),C(x)}))}else C(x)})).catch((function(e){console.warn("Caught error in useData!",e),C(w)})))}),[t,o,n]),{user:o,events:h,numEventsLoaded:k,status:D}}function k(e){var t=e.getFullYear(),a="".concat(e.getMonth()+1).padStart(2,"0"),n="".concat(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(n)}function _(e){return new Intl.DateTimeFormat("en-CA",{dateStyle:"full"}).format(e)}var N=a(11),T=a.n(N),D=a(13),C=a.n(D),S=a(14),R=a.n(S);var A=function(e){var t=e.options,a={color:"#fff",fontFamily:"Raleway, sans-serif",fontWeight:"normal"},r={animation:!1,enableMouseTracking:!1,borderWidth:0,color:"#ff4800",cursor:"pointer",pointPadding:0,dataLabels:{enabled:!0,crop:!1,overflow:"none",style:Object(l.a)(Object(l.a)({},a),{},{fontSize:"9pt",fontWeight:700})}},s={title:{style:Object(l.a)(Object(l.a)({},a),{},{fontWeight:"700"})},chart:{type:"bar",backgroundColor:null,plotBackgroundColor:null,style:a},plotOptions:{bar:r,column:r},yAxis:{title:"Number of events",gridLineWidth:1,gridLineColor:"#3d3d3d",labels:{style:a}},xAxis:{type:"category",lineWidth:1,lineColor:"#3d3d3d",labels:{style:a,autoRotation:!1,allowOverlap:!1,overflow:"allow"}},credits:{enabled:!1},legend:{enabled:!1}};return Object(n.jsx)("div",{className:"chart-block",children:Object(n.jsx)(C.a,{highcharts:T.a,options:R()(s,t)})})},L={sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat"};var E=function(e){var t=function(e){var t=["sun","mon","tue","wed","thu","fri","sat"],a=Array(7).fill(0);return e.forEach((function(e){var t=new Date(e.created_at).getDay();a[t]++})),a.reduce((function(e,a,n){return Object(l.a)(Object(l.a)({},e),{},Object(h.a)({},t[n],a))}),{})}(e.data),a={title:{text:"Events by Day of the Week"},chart:{width:500,height:200,type:"column"},yAxis:{labels:{enabled:!1}},series:[{name:"Counts",data:Object.keys(t).map((function(e){return[L[e],t[e]]}))}]};return Object(n.jsx)(A,{options:a})},I={comment:"Commented",commit:"Pushed commits",openedIssue:"Opened issue",closedIssue:"Closed issue",openedMilestone:"Opened milestone",closedMilestone:"Closed milestone",destroyedMilestone:"Destroyed milestone",openedMr:"Opened MR",approvedMr:"Approved MR",acceptedMr:"Accepted MR",closedMr:"Closed MR",createdTag:"Created tag",deletedTag:"Deleted tag",createdBranch:"Created branch",deletedBranch:"Deleted branch"};var P=function(e){var t=function(e){var t={comment:0,commit:0,openedIssue:0,closedIssue:0,openedMilestone:0,closedMilestone:0,destroyedMilestone:0,openedMr:0,approvedMr:0,acceptedMr:0,closedMr:0,createdTag:0,deletedTag:0,createdBranch:0,deletedBranch:0};return e.forEach((function(e){"commented on"===e.action_name?t.comment++:"opened"===e.action_name&&"Issue"===e.target_type?t.openedIssue++:"closed"===e.action_name&&"Issue"===e.target_type?t.closedIssue++:"opened"===e.action_name&&"Milestone"===e.target_type?t.openedMilestone++:"closed"===e.action_name&&"Milestone"===e.target_type?t.closedMilestone++:"destroyed"===e.action_name&&"Milestone"===e.target_type?t.destroyedMilestone++:"opened"===e.action_name&&"MergeRequest"===e.target_type?t.openedMr++:"approved"===e.action_name&&"MergeRequest"===e.target_type?t.approvedMr++:"accepted"===e.action_name&&"MergeRequest"===e.target_type?t.acceptedMr++:"closed"===e.action_name&&"MergeRequest"===e.target_type?t.closedMr++:"pushed new"===e.action_name&&"tag"===e.push_data.ref_type?t.createdTag++:"deleted"===e.action_name&&"tag"===e.push_data.ref_type?t.deletedTag++:"pushed new"===e.action_name&&"branch"===e.push_data.ref_type?t.createdBranch++:"deleted"===e.action_name&&"branch"===e.push_data.ref_type?t.deletedBranch++:"pushed to"===e.action_name?t.commit++:"created"===e.action_name||"joined"===e.action_name||"left"===e.action_name||console.warn("unrecognized event",e)})),t}(e.data),a={title:{text:"Events by Type"},chart:{width:500,height:500},series:[{name:"Counts",data:Object.keys(t).map((function(e){return[I[e],t[e]]}))}]};return Object(n.jsx)(A,{options:a})};var F=function(e){var t=e.data,a=new Blob([JSON.stringify(t)],{type:"text/json;charset=utf-8"}),s=URL.createObjectURL(a);return Object(r.useEffect)((function(){return function(){URL.revokeObjectURL(s)}}),[s]),Object(n.jsx)("p",{children:Object(n.jsx)("a",{href:s,download:"data.json",children:"Download data as JSON"})})};var U=function(e){var t=e.current,a=e.total,r=t/a*100;return Object(n.jsxs)("div",{className:"loader",children:[Object(n.jsxs)("label",{htmlFor:"loader",children:["Loaded ",t," of ",a," events"]}),Object(n.jsxs)("progress",{id:"loader",className:"progress",max:a,value:t,children:[r,"%"]})]})};var W=function(e){for(var t=e.count,a=e.label,r=e.showCount,s=void 0===r||r,c=e.thresholds,o=0,l=c.length-1;l>=0;l--)if(t>=c[l].value){o=l;break}var i="tapestry-cell tapestry-cell--".concat(o);return Object(n.jsx)("div",{className:i,"data-label":a,"data-count":t,title:a,children:s&&t?t:""})},q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var B=function(e){var t=e.year,a=e.month,r=e.numWeeksInMonth,s="tapestry-label tapestry-label--".concat(r),c=q[a],o="".concat(c," ").concat(t);return Object(n.jsxs)("div",{title:o,"data-month":a,"data-year":t,className:s,children:[!a&&Object(n.jsx)("span",{className:"tapestry-label-year",children:t}),Object(n.jsx)("span",{className:"tapestry-label-month",children:c})]})},H=[{value:0,label:"Bland: 0"},{value:1,label:"Mild: 1 to 9 contributions"},{value:10,label:"Medium: 10 to 19 contributions"},{value:20,label:"Hot: 20 to 29 contributions"},{value:30,label:"Extra hot: 30 to 39 contributions"},{value:40,label:"Are you sure this is edible?: 40 to 49 contributions"},{value:50,label:"Actual fire: 50+ contributions"}];var J=function(e){var t=e.cells,a=function(e,t){var a=Object(f.a)(Array(t).keys()),n=[],r=null;return a.forEach((function(t){var a=new Date(e);a.setDate(a.getDate()+7*t);var s=a.getMonth();r&&r.month===s?r.numWeeksInMonth++:(r={year:a.getFullYear(),month:s,numWeeksInMonth:1},n.push(r))})),n}(e.startDate,Math.ceil(t.length/7));return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)("div",{className:"tapestry-window",children:[Object(n.jsx)("div",{className:"tapestry-labels",children:a.map((function(e,t){return Object(n.jsx)(B,Object(l.a)({},e),"".concat(e.year).concat(e.month))}))}),Object(n.jsx)("div",{className:"tapestry",children:t.map((function(e){return Object(n.jsx)(W,Object(l.a)({thresholds:H},e),e.label)}))})]}),Object(n.jsx)("div",{className:"tapestry-legend",children:H.map((function(e){return Object(n.jsx)(W,{count:e.value,label:e.label,showCount:!1,thresholds:H},"legend-".concat(e.value))}))})]})};var G=function(e){var t=e.data,a=e.startDate,r=e.endDate.getTime()-a.getTime(),s=Math.ceil(r/1e3/60/60/24),c=s%7,o=5*Math.floor(s/7);c>1&&(o+=c-1);var l=s?Math.round(t.length/s*100)/100:0,i=o?Math.round(t.length/o*100)/100:0;return Object(n.jsxs)("div",{className:"row",children:[Object(n.jsxs)("p",{className:"stats-block","data-testid":"avgPerDay",children:["Average of ",Object(n.jsx)("span",{className:"highlight",children:l})," events per day"]}),o&&Object(n.jsxs)("p",{className:"stats-block","data-testid":"avgPerWeekday",children:["Average of ",Object(n.jsx)("span",{className:"highlight",children:i})," events per day, excluding weekends"]})]})};var z=function(e){var t=M({host:e.host,username:e.username,accessToken:e.accessToken}),a=t.user,r=t.events,s=t.numEventsLoaded,c=t.status,o=r.data,i=r.total;if(c===y)return Object(n.jsx)(U,{current:s,total:i});if(c===w)return Object(n.jsx)("div",{className:"dashboard",children:Object(n.jsx)("p",{children:"Something went wrong :("})});if(!o.length)return Object(n.jsx)("div",{className:"dashboard",children:Object(n.jsxs)("p",{children:["No activity found for @",a.username," :("]})});var d=function(e){var t=new Date(e);return t.setDate(t.getDate()-t.getDay()),t}(o[o.length-1].created_at),u=new Date(o[0].created_at),b=function(e,t){for(var a=new Date(t),n=new Date(e),r=[];a>n;)r.push(k(a)),a.setDate(a.getDate()-1);return r}(d,u).reduce((function(e,t){return Object(l.a)(Object(l.a)({},e),{},Object(h.a)({},t,0))}),{});o.forEach((function(e){var t=k(new Date(e.created_at));b[t]++}));var m=Object.keys(b).reverse().map((function(e){return{label:e,count:b[e]}}));return Object(n.jsxs)("div",{className:"dashboard",children:[Object(n.jsxs)("h2",{children:["@",a.username]}),Object(n.jsxs)("p",{children:["Showing ",Object(n.jsxs)("b",{children:[o.length," events"]})," from ",_(d)," to ",_(u),"."]}),Object(n.jsx)(J,{cells:m,startDate:d}),Object(n.jsx)(G,{data:o,startDate:d,endDate:u}),Object(n.jsxs)("div",{className:"row",children:[Object(n.jsx)(P,{data:o}),Object(n.jsx)(E,{data:o})]}),Object(n.jsx)(F,{data:r})]})};var Y=function(){var e,t=Object(r.useState)(null),a=Object(i.a)(t,2),s=a[0],c=a[1];return e=s&&s.username?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(z,Object(l.a)({},s)),Object(n.jsx)("button",{className:"btn",onClick:function(){return c(Object(l.a)(Object(l.a)({},s),{},{username:null}))},children:"< Try another user"})]}):Object(n.jsx)(b,{onSubmit:c}),Object(n.jsxs)("div",{children:[Object(n.jsx)("h1",{children:"How spicy is your GitLab activity? \ud83d\udd25"}),e]})},K=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,26)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,s=t.getLCP,c=t.getTTFB;a(e),n(e),r(e),s(e),c(e)}))};o.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(Y,{})}),document.getElementById("root")),K()}},[[25,1,2]]]);
//# sourceMappingURL=main.49239fea.chunk.js.map